/*!
 * FlatScroll.js v0.0.1
 * Copyright 2013, Thierry Francois @colymba
 * @licence BSD 3 Clause license : http://opensource.org/licenses/BSD-3-Clause
 */
(function(t){t.FlatScroll=function(o,i){this.dom={},this.dom.container=t(i),this.$document=t(document),this.$window=t(window),this._init(o)},t.FlatScroll.settings={namespace:"flatScroll",baseClass:"flatScroll",direction:"vertical",scrollerWidth:"auto"},t.FlatScroll.prototype={_init:function(o){this.options=t.extend({},t.FlatScroll.settings,o),this.data={},this._build(),"horizontal"===this.options.direction&&this._fitScrollerWidth(),this._fitScrollBar(),this._updateThumbSize(),this._regHandlers()},destroy:function(){this._removeHandlers(),this._deleteNodes()},_build:function(){var t=this.dom.container,o=this.options.baseClass+"_wrap",i=this.options.baseClass+"_scroll",s=this.options.baseClass+"_container",r='<div class="'+this.options.direction+" "+o+'">'+'<div class="'+i+'">'+"</div>"+"</div>",e='<div class="bar"><div class="thumb"></div></div>';t.addClass(s).wrapInner(r).find("."+this.options.baseClass+"_wrap").append(e),this.dom.wrapper=t.find("."+o),this.dom.scroller=t.find("."+i),this.dom.bar=t.find(".bar"),this.dom.thumb=t.find(".thumb")},_deleteNodes:function(){var t=this.options.baseClass+"_container",o=this.dom.scroller.html();this.dom.container.removeClass(t).empty().html(o)},_regHandlers:function(){var o=this.options.namespace;_this=this,this.dom.bar.on("mousedown."+o,t.proxy(this._scrollJump,this)),this.dom.thumb.on("mousedown."+o,t.proxy(this._startScroll,this)),this.dom.thumb.on("mouseup."+o,t.proxy(this._stopScroll,this)),this.dom.thumb.on("mousemove."+o,t.proxy(this._scroll,this)),this.dom.wrapper.on("scroll."+o,t.proxy(this._updateScrollBar,this)),this.dom.container.on("scroll."+o,t.proxy(this._lockContainerScroll,this)),this.$document.on("mouseup."+o,t.proxy(this._stopScroll,this)),this.$document.on("mouseleave."+o,t.proxy(this._stopScroll,this)),this.$document.on("mousemove."+o,t.proxy(this._scroll,this)),t.isFunction(t.throttle)?this.$window.on("resize."+o,t.throttle(250,t.proxy(_this._windowResizeUpdates,_this))):this.$window.on("resize."+o,t.proxy(this._windowResizeUpdates,this))},_removeHandlers:function(){var t=this.options.namespace;this.dom.bar.off("mousedown."+t),this.dom.thumb.off("mousedown."+t),this.dom.thumb.off("mouseup."+t),this.dom.thumb.off("mousemove."+t),this.dom.wrapper.off("scroll."+t),this.dom.container.off("scroll."+t),this.$document.off("mouseup."+t),this.$document.off("mouseleave."+t),this.$document.off("mousemove."+t),this.$window.off("resize."+t)},_windowResizeUpdates:function(t){this._fitScrollBar(),this._updateThumbSize(),this._fixScrollBarScrollPosition(t.data)},_updateScrollData:function(){var t=this.data,o=this.dom.thumb,i=o.height(),s=o.width(),r=this.dom.bar,e=(r.offset().top,r.offset().left,r.height()),a=r.width(),h=event.pageY,l=event.pageX,d=t.dragStartY,n=t.dragStartX;t.deltaY=Math.abs(d-h),t.deltaX=Math.abs(n-l),t.directionX=t.directionY=1,t.minV=0,t.maxV=e-i,t.minH=0,t.maxH=a-s,d>h&&(t.directionY=-1),n>l&&(t.directionX=-1),t.dragStartY=h,t.dragStartX=l,this.data=t},_startScroll:function(t){this.data.drag=!0,this.data.dragStartY=t.pageY,this.data.dragStartX=t.pageX,this._disableSelection(),t.stopPropagation()},_stopScroll:function(){this.data.drag=!1,this._enableSelection()},_scroll:function(t,o){if(this.data.drag){this._updateScrollData();var i,s,o=this.data;"vertical"===this.options.direction?(i=this.dom.thumb.position().top+o.deltaY*o.directionY,i>o.maxV&&(i=o.maxV),o.minV>i&&(i=o.minV),this.dom.thumb.css({top:i+"px"})):(s=this.dom.thumb.position().left+o.deltaX*o.directionX,s>o.maxH&&(s=o.maxH),o.minH>s&&(s=o.minH),this.dom.thumb.css({left:s+"px"})),this._doScroll()}},_doScroll:function(){var t,o,i;"vertical"===this.options.direction?(t=this.dom.thumb.position().top/this.data.maxV,o=this.dom.scroller.height()-this.dom.wrapper.height(),i=o*t,this.dom.wrapper.scrollTop(i),this.dom.bar.css({top:i+"px"})):(t=this.dom.thumb.position().left/this.data.maxH,o=this.dom.scroller.width()-this.dom.wrapper.width(),i=o*t,this.dom.wrapper.scrollLeft(i),this.dom.bar.css({left:i+"px"}))},_scrollJump:function(t){this._updateScrollData();var o,i,s,r=t.pageY,e=t.pageX,a=this.dom.bar.offset(),h=a.top,l=a.left,d=r-h,n=e-l;"vertical"===this.options.direction?(o=this.dom.scroller.height()-this.dom.wrapper.height(),i=d/this.dom.bar.height(),s=o*i,this.dom.wrapper.scrollTop(s),this.dom.bar.css({top:s+"px"})):(o=this.dom.scroller.width()-this.dom.wrapper.width(),i=n/this.dom.bar.width(),s=o*i,this.dom.wrapper.scrollLeft(s),this.dom.bar.css({left:s+"px"}))},_updateScrollBar:function(){if(!this.data.drag){this._updateScrollData();var t,o,i,s,r=this.dom.wrapper,e=this.dom.scroller;"vertical"===this.options.direction?(t=e.height()-r.height(),r.scrollTop()>t&&r.scrollTop(t),o=r.scrollTop(),scrolledPercent=o/t,i=this.data.maxV*scrolledPercent,i>this.data.maxV&&(i=this.data.maxV),this.data.minV>i&&(i=this.data.minV),this.dom.bar.css({top:o+"px"}),this.dom.thumb.css({top:i+"px"})):(t=e.width()-r.width(),r.scrollLeft()>t&&r.scrollLeft(t),o=r.scrollLeft(),scrolledPercent=o/t,s=this.data.maxH*scrolledPercent,s>this.data.maxH&&(s=this.data.maxH),this.data.minH>s&&(s=this.data.minH),this.dom.bar.css({left:o+"px"}),this.dom.thumb.css({left:s+"px"}))}},_fitScrollerWidth:function(){var o=this.options.scrollerWidth;"auto"===this.options.scrollerWidth&&(o=0,this.dom.scroller.children().each(function(i,s){o+=t(s).outerWidth(!0)}),o+="px"),this.dom.scroller.css("width",o)},_fitScrollBar:function(){"vertical"===this.options.direction?this.dom.bar.height(this.dom.wrapper.height()):this.dom.bar.width(this.dom.wrapper.width())},_updateThumbSize:function(){var t;t="vertical"===this.options.direction?100*(this.dom.wrapper.height()/this.dom.scroller.height()):100*(this.dom.wrapper.width()/this.dom.scroller.width()),t>100?t=100:0>t&&(t=0),"vertical"===this.options.direction?this.dom.thumb.css({height:t+"%"}):this.dom.thumb.css({width:t+"%"})},_fixScrollBarScrollPosition:function(){var t;wrapper=this.dom.wrapper,scroller=this.dom.scroller,"vertical"===this.options.direction?(t=scroller.height()-wrapper.height(),wrapper.scrollTop()>t&&(0>t&&(t=0),wrapper.scrollTop(t))):(t=scroller.width()-wrapper.width(),wrapper.scrollLeft()>t&&(0>t&&(t=0),wrapper.scrollLeft(t)))},_disableSelection:function(){this.$document.attr("unselectable","on").css("user-select","none").on("selectstart",!1)},_enableSelection:function(){this.$document.removeAttr("unselectable").css("user-select","auto").off("selectstart",!1)},_lockContainerScroll:function(t){return t.preventDefault(),this.dom.container.scrollLeft(0),this.dom.container.scrollTop(0),!1}},t.fn.flatScroll=function(o){return"string"==typeof o?this.each(function(){var i=t.data(this,"flatScroll");return i?t.isFunction(i[o])?(i[o].apply(i),void 0):(window.console.error("no such method '"+o+"' on flatScroll instance."),void 0):(window.console.error('Cannot call "'+o+'" before initialisation.'),void 0)}):this.each(function(){var i=t.data(this,"flatScroll");i?i._init(o):t.data(this,"flatScroll",new t.FlatScroll(o,this))}),this}})(jQuery);